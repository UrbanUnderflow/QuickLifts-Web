(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[537],{3212:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/round/[id]",function(){return s(9445)}])},3346:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(1134).Z)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},2171:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(1134).Z)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},4307:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(1134).Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},5432:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(1134).Z)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]])},3050:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(1134).Z)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},39:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(1134).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},4795:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(1134).Z)("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]])},1781:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(1134).Z)("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]])},8267:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(1134).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},9176:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(1134).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},8071:function(e,t,s){"use strict";s.d(t,{f:function(){return l}});var a=s(5893);s(7294);let l=e=>{let{gifUrl:t,alt:s,frameSize:l,contentMode:n="cover",className:r="",onClick:i}=e,c=l?{width:`${l.width}px`,height:`${l.height}px`}:{};return(0,a.jsx)("div",{className:`relative overflow-hidden rounded-full cursor-pointer ${r}`,style:c,onClick:i,children:(0,a.jsx)("img",{src:t,alt:s,className:`w-full h-full object-${n}`,loading:"lazy"})})}},359:function(e,t,s){"use strict";s.d(t,{kg:function(){return j},ox:function(){return y}});var a=s(5893),l=s(7294),n=s(5432),r=s(2171),i=s(8267),c=s(39),d=s(4307),o=s(3050),h=s(2066),m=s(4454),x=s(8071);let u=e=>{let{month:t,day:s,weekday:l}=e;return(0,a.jsxs)("div",{className:"flex flex-col items-center bg-zinc-800 rounded p-2 text-xs",children:[(0,a.jsx)("span",{className:"text-gray-400",children:t}),(0,a.jsx)("span",{className:"text-white font-bold text-lg",children:s}),(0,a.jsx)("span",{className:"text-gray-400",children:l})]})},g=e=>{let{icon:t,value:s,label:l}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-1 text-gray-400",children:[t,(0,a.jsxs)("span",{className:"text-sm",children:[s," ",l]})]})},f=e=>{let{selectedOrder:t,maxOrder:s,workoutDate:l,showCalendar:i,onUpdateOrder:c,onCalendarTap:d}=e;return(0,a.jsxs)("div",{className:"flex flex-col justify-between py-2 px-4 bg-zinc-800",children:[(0,a.jsx)("button",{onClick:()=>c(t-1),disabled:t<=0,className:`p-2 ${t>0?"text-green-500 hover:text-green-400":"text-gray-600"}`,children:(0,a.jsx)(n.Z,{size:16})}),i&&l&&(0,a.jsx)("button",{onClick:()=>d?.(l),className:"my-2",children:(0,a.jsx)(u,{month:(0,h.WU)(l,"MMM").toUpperCase(),day:(0,h.WU)(l,"d"),weekday:(0,h.WU)(l,"EEE").toUpperCase()})}),(0,a.jsx)("button",{onClick:()=>c(t+1),disabled:t>=s-1,className:`p-2 ${t<s-1?"text-green-500 hover:text-green-400":"text-gray-600"}`,children:(0,a.jsx)(r.Z,{size:16})})]})},p=(e,t,s)=>{if(!s?.length)return!1;let a=new Date(t);a.setHours(0,0,0,0);let l=new Date(t);l.setHours(23,59,59,999);let n=s.filter(e=>{if(!e.completedAt)return!1;let t=new Date(e.completedAt);return t>=a&&t<l}),r=e.exercises.map(e=>e.exercise.id);return n.some(e=>{if(!e.completedAt)return!1;let t=e.exercisesCompleted.map(e=>e.exercise.id);return!!r.some(e=>t.includes(e))&&new Date(e.completedAt).getHours()>=6})},j=e=>{let{workout:t,gifUrls:s,selectedOrder:n,maxOrder:r,showArrows:h,showCalendar:u,workoutDate:j,backgroundColor:y="bg-zinc-800",isComplete:w=!1,isChallengeEnabled:v=!1,challengeStartDate:N,challengeHasStarted:b,currentDayIndex:D,userChallenge:k,allWorkoutSummaries:C,index:I,onPrimaryAction:M,onCalendarTap:E,onUpdateOrder:S}=e,[z,F]=(0,l.useState)(w);(0,l.useEffect)(()=>{if(console.log("\n\uD83D\uDD0D Checking workout completion status"),console.log("\uD83D\uDCCA Initial Data:",{workoutId:t.id,workoutDate:j,challengeStartDate:N,isChallengeEnabled:v,initialIsComplete:w}),!N||!v){console.log("❌ No challenge date or challenge not enabled"),F(w);return}if(j&&j>new Date){console.log("⏳ Future date detected, marking incomplete:",j),F(!1);return}let e=k?.completedWorkouts?.some(e=>(console.log("Comparing:",{completedWorkoutId:e.workoutId,currentWorkoutId:t.id,matches:e.workoutId===t.id}),e.workoutId===t.id));console.log("\uD83C\uDFC6 Completion from userChallenge:",{isMarkedComplete:e,completedWorkouts:k?.completedWorkouts});let s=!!j&&p(t,j,C);console.log("\uD83D\uDCDD Completion from logs:",{completedViaLogs:s,summariesCount:C?.length||0});let a=e||s;console.log("✅ Final completion status:",a),F(a)},[t,N,k,C,j]);let T=`
    rounded-lg overflow-hidden cursor-pointer ${y}
    ${void 0!==I&&I<(D||0)||z?"opacity-70":"opacity-100"}
    ${((e,t)=>{if(void 0===e||!t)return!1;let s=new Date;s.setHours(0,0,0,0);let a=new Date(t);return a.setHours(0,0,0,0),e===Math.floor(Math.abs(s.getTime()-a.getTime())/864e5)})(I,N)&&b?"ring-2 ring-green-500":""}
  `;return(0,a.jsx)("div",{onClick:M,className:T,children:(0,a.jsxs)("div",{className:"flex",children:[h&&void 0!==n&&void 0!==r&&S&&(0,a.jsx)(f,{selectedOrder:n,maxOrder:r,workoutDate:j,showCalendar:!!u,onUpdateOrder:S,onCalendarTap:E}),(0,a.jsxs)("div",{className:"flex-1 p-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-white mb-2",children:t.title}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)(g,{icon:(0,a.jsx)(i.Z,{size:16}),value:String(t.exercises.length),label:"moves"}),(0,a.jsx)(g,{icon:(0,a.jsx)(c.Z,{size:16}),value:1>m.oQ.estimatedDuration(t.exercises)?"< 1":String(m.oQ.estimatedDuration(t.exercises)),label:"min"})]})]}),(0,a.jsx)(d.Z,{className:"text-gray-500",size:20})]}),(0,a.jsx)("div",{className:"flex gap-2 mb-4 overflow-x-auto",children:s.slice(0,3).map((e,s)=>(0,a.jsx)("div",{className:"w-24 h-24 rounded-lg overflow-hidden flex-shrink-0",children:(0,a.jsx)(x.f,{gifUrl:e,alt:`Exercise ${s+1} preview`,className:"w-full h-full"})},`${t.id}-gif-${s}`))}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"px-3 py-1 bg-green-500 bg-opacity-20 text-green-500 rounded-full text-sm",children:t.zone}),v&&(0,a.jsx)(o.Z,{className:z?"text-green-500":"text-gray-600",size:20})]})]})]})})},y=e=>{let{selectedOrder:t,maxOrder:s,showArrows:n,showCalendar:r,workoutDate:i,backgroundColor:c="bg-zinc-800",isComplete:d=!1,challengeStartDate:h,challengeHasStarted:m,currentDayIndex:x,index:u,onPrimaryAction:g,onCalendarTap:p,onUpdateOrder:j}=e,[y,w]=(0,l.useState)(d);(0,l.useEffect)(()=>{if(!h||!i){w(d);return}w(i<=new Date)},[i,h,d]);let v=`
    rounded-lg overflow-hidden cursor-pointer ${c}
    ${void 0!==u&&u<(x||0)||y?"opacity-70":"opacity-100"}
    ${((e,t)=>{if(void 0===e||!t)return!1;let s=new Date;s.setHours(0,0,0,0);let a=new Date(t);return a.setHours(0,0,0,0),e===Math.floor(Math.abs(s.getTime()-a.getTime())/864e5)})(u,h)&&m?"ring-2 ring-green-500":""}
  `;return(0,a.jsx)("div",{onClick:g,className:v,children:(0,a.jsxs)("div",{className:"flex",children:[n&&void 0!==t&&void 0!==s&&j&&(0,a.jsx)(f,{selectedOrder:t,maxOrder:s,workoutDate:i,showCalendar:!!r,onUpdateOrder:j,onCalendarTap:p}),(0,a.jsxs)("div",{className:"flex-1 p-4",children:[(0,a.jsx)("div",{className:"flex justify-between items-start mb-4",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-white mb-2",children:"Rest Day"}),(0,a.jsx)("p",{className:"text-gray-400 text-sm",children:"Take a moment to recover and come back stronger."})]})}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"px-3 py-1 bg-green-500 bg-opacity-20 text-green-500 rounded-full text-sm",children:"Recovery"}),(0,a.jsx)(o.Z,{className:y?"text-green-500":"text-gray-600",size:20})]})]})]})})}},9445:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return R}});var a,l,n,r,i=s(5893),c=s(7294),d=s(2171),o=s(3346),h=s(4454),m=s(359),x=s(1781),u=s(8267),g=e=>{let{participants:t,onParticipantClick:s}=e,[a,l]=c.useState([]),[n,r]=c.useState(!1),d=[...t].sort((e,t)=>o(t)-o(e));function o(e){let t=e.pulsePoints;return t.baseCompletion+t.firstCompletion+t.streakBonus+t.checkInBonus+t.effortRating+t.chatParticipation+t.locationCheckin+t.contentEngagement+t.encouragementSent+t.encouragementReceived}c.useEffect(()=>{l(d.map((e,t)=>t+1))},[t.length]);let h=n?d:d.slice(0,5);return(0,i.jsxs)("div",{className:"bg-zinc-800 rounded-xl p-6 mt-6",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold text-white mb-4",children:"Participants"}),(0,i.jsx)("div",{className:"space-y-4",children:h.map((e,t)=>(0,i.jsxs)("div",{onClick:()=>s?.(e),className:"flex items-center justify-between p-4 bg-zinc-900 rounded-lg cursor-pointer hover:bg-zinc-800 transition-colors",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,i.jsx)("div",{className:"flex items-center justify-center w-8",children:t<3?(0,i.jsx)(x.Z,{className:0===t?"text-yellow-500":1===t?"text-gray-400":"text-amber-600",size:20}):(0,i.jsxs)("span",{className:"text-zinc-400",children:["#",t+1]})}),e.profileImage?.profileImageURL?(0,i.jsx)("img",{src:e.profileImage.profileImageURL,alt:e.username,className:"w-10 h-10 rounded-full"}):(0,i.jsx)("div",{className:"w-10 h-10 rounded-full bg-zinc-700 flex items-center justify-center",children:(0,i.jsx)(u.Z,{className:"text-zinc-400",size:20})}),(0,i.jsx)("div",{children:(0,i.jsx)("div",{className:"flex items-center space-x-2",children:(0,i.jsx)("span",{className:"text-white font-medium",children:e.username})})})]}),(0,i.jsxs)("div",{className:"text-right",children:[(0,i.jsxs)("div",{className:"text-white font-medium",children:[o(e)," pts"]}),(0,i.jsxs)("div",{className:"text-sm text-zinc-400",children:["\uD83D\uDD25 ",e.currentStreak," day streak"]})]})]},e.id))}),t.length>5&&(0,i.jsx)("button",{onClick:()=>{r(e=>!e)},className:"mt-4 text-sm text-[#E0FE10] hover:text-gray-400",children:n?"Show less":`Show all (${t.length})`})]})};(a=n||(n={})).None="none",a.Image="image",a.Video="video",a.Audio="audio",(l=r||(r={})).Encourage="\uD83D\uDCAA Keep it up!",l.Congrats="\uD83C\uDF89 Great work!",l.Support="You've got this!",l.Thanks="Thank you!";let f=e=>({sender:e.sender,content:e.content,checkinId:e.checkinId||null,timestamp:e.timestamp,readBy:e.readBy,mediaURL:e.mediaURL||null,mediaType:e.mediaType,gymName:e.gymName||null}),p=(e,t)=>({id:e,sender:t.sender,content:t.content,checkinId:t.checkinId||null,timestamp:t.timestamp instanceof Date?t.timestamp:new Date(t.timestamp),readBy:t.readBy||{},mediaURL:t.mediaURL||null,mediaType:t.mediaType||"none",gymName:t.gymName||null});var j=s(1134);let y=(0,j.Z)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),w=(0,j.Z)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);var v=e=>{let{message:t,isSentByCurrentUser:s}=e;return(0,i.jsx)("div",{className:`flex ${s?"justify-end":"justify-start"} mb-4`,children:(0,i.jsxs)("div",{className:`max-w-xs px-4 py-2 rounded-lg ${s?"bg-green-500 text-white":"bg-gray-700 text-gray-200"}`,children:[t.mediaURL?(0,i.jsx)("img",{src:t.mediaURL,alt:"Media",className:"w-full rounded-lg mb-2"}):null,(0,i.jsx)("p",{children:t.content}),(0,i.jsx)("p",{className:"text-xs text-gray-400 mt-2",children:new Date(t.timestamp).toLocaleTimeString()})]})})},N=e=>{let{participants:t,messages:s,onSendMessage:a,currentUser:l}=e,[n,d]=(0,c.useState)(""),[o,h]=(0,c.useState)(null),[m,x]=(0,c.useState)(null),u=(0,c.useRef)(null);if(!l)return null;let g=[r.Encourage,r.Congrats,r.Support,r.Thanks];(0,c.useEffect)(()=>{m&&(d(m),x(null))},[m]),(0,c.useEffect)(()=>{f()},[s]);let f=()=>{u.current?.scrollIntoView({behavior:"smooth"})};return(0,i.jsxs)("div",{className:"bg-zinc-900 text-white rounded-xl flex flex-col h-[600px]",children:[(0,i.jsxs)("div",{className:"p-4 flex justify-between items-center bg-zinc-800 rounded-t-xl",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-lg font-bold",children:"Round Table"}),(0,i.jsxs)("p",{className:"text-sm text-gray-400",children:[t.length," active now"]})]}),(0,i.jsx)("button",{className:"text-gray-400 hover:text-white transition",children:(0,i.jsx)(y,{size:20})})]}),(0,i.jsxs)("div",{className:"flex-1 overflow-y-auto p-4",children:[0===s.length?(0,i.jsx)("div",{className:"flex flex-col items-center justify-center h-full text-gray-400",children:(0,i.jsx)("p",{children:"No messages yet. Start the conversation!"})}):s.map(e=>(0,i.jsx)(v,{message:e,isSentByCurrentUser:e.sender.id===l.id},e.id)),(0,i.jsx)("div",{ref:u})]}),(0,i.jsxs)("div",{className:"p-4 bg-zinc-800 rounded-b-xl",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,i.jsxs)("label",{className:"cursor-pointer",children:[(0,i.jsx)(w,{size:24,className:"text-gray-400 hover:text-white transition"}),(0,i.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:e=>{let t=e.target.files?.[0];t&&h(t)}})]}),(0,i.jsx)("input",{type:"text",value:n,onChange:e=>d(e.target.value),placeholder:"Type a message...",className:"flex-1 bg-zinc-700 rounded-lg p-2 text-sm text-white placeholder-gray-400 focus:outline-none"}),(0,i.jsx)("button",{className:`p-2 rounded-lg ${n.trim()||o?"bg-green-500 hover:bg-green-600":"bg-gray-500 cursor-not-allowed"}`,onClick:()=>{(n.trim()||o)&&(a(n.trim(),o||void 0),d(""),h(null))},disabled:!n.trim()&&!o,children:(0,i.jsx)(y,{size:20,className:"text-white"})})]}),o&&(0,i.jsxs)("div",{className:"mt-2 flex items-center",children:[(0,i.jsx)("img",{src:URL.createObjectURL(o),alt:"Selected",className:"w-16 h-16 rounded-lg object-cover"}),(0,i.jsx)("button",{onClick:()=>h(null),className:"ml-2 text-red-500 hover:text-red-700",children:"Remove"})]})]}),(0,i.jsx)("div",{className:"flex space-x-2 p-4 bg-zinc-900",children:g.map(e=>(0,i.jsx)("button",{className:"px-4 py-2 bg-zinc-800 rounded-full text-sm text-gray-400 hover:bg-zinc-700 hover:text-white",onClick:()=>x(e),children:e},e))})]})},b=s(9586),D=s(6045),k=s(1163),C=s(5007),I=s(7333),M=s(109),E=s(6650);class S{constructor(){this.messagesPerPage=50}static getInstance(){return S.instance||(S.instance=new S),S.instance}validateCollectionId(e){return!(!e||"string"!=typeof e||""===e.trim()||e.length>1500||/[\/.]/.test(e))||(console.error(`Invalid collection ID: ${e}`),!1)}getMessagesRef(e){if(!this.validateCollectionId(e))return null;let t=(0,M.JU)(I.db,"sweatlist-collection",e);return(0,M.hJ)(t,"messages")}async fetchChallengeMessages(e,t){try{let s=this.getMessagesRef(e);if(!s)return[];let a=(0,M.IO)(s,(0,M.Xo)("timestamp","desc"),(0,M.b9)(this.messagesPerPage));return t&&(a=(0,M.IO)(a,(0,M.TQ)(t))),(await (0,M.PL)(a)).docs.map(e=>this.parseMessageDocument(e)).reverse()}catch(e){return console.error("Error fetching messages:",e),[]}}subscribeToMessages(e,t){try{let s=this.getMessagesRef(e);if(!s)return()=>{};let a=(0,M.IO)(s,(0,M.Xo)("timestamp","asc"));return(0,M.cf)(a,e=>{let s=e.docs.map(e=>this.parseMessageDocument(e));t(s)})}catch(e){return console.error("Error subscribing to messages:",e),()=>{}}}async sendMessage(e,t){try{let s=this.getMessagesRef(e);if(!s)return null;let a=await (0,M.ET)(s,f(t));return{...t,id:a.id}}catch(e){return console.error("Error sending message:",e),null}}parseMessageDocument(e){return p(e.id,e.data())}async uploadMedia(e){try{let t=(0,E.iH)(I.t,`chat-media/${Date.now()}_${e.name}`),s=await (0,E.KV)(t,e);return await (0,E.Jt)(s.ref)}catch(e){return console.error("Error uploading media:",e),null}}async markMessagesAsRead(e,t,s){try{if(!this.validateCollectionId(e))return;let a=(0,M.JU)(I.db,"sweatlist-collection",e);await Promise.all(s.map(async e=>{let s=(0,M.JU)(a,"messages",e);await (0,M.r7)(s,{[`readBy.${t}`]:M.EK.now()})}))}catch(e){console.error("Error marking messages as read:",e)}}}var z=s(4795),F=s(9176),T=s(39);let U=e=>{let{viewModel:t,initialParticipants:s}=e,a=t.challengeDetailViewModel.collection,[l,n]=(0,c.useState)(s),[r,d]=(0,c.useState)(null),[o,m]=(0,c.useState)([]),[x,u]=(0,c.useState)({days:0,hours:0,minutes:0}),[g,f]=(0,c.useState)(!1),p=(0,k.useRouter)();D.W4.currentUser;let j=e=>{let t=new Date,s=e.getTime()-t.getTime();return s<=0?{days:0,hours:0,minutes:0}:{days:Math.floor(s/864e5),hours:Math.floor(s/36e5%24),minutes:Math.floor(s/6e4%60)}};(0,c.useEffect)(()=>{if(t.challenge?.startDate){u(j(new Date(t.challenge.startDate)));let e=setInterval(()=>{u(j(new Date(t.challenge.startDate)))},6e4);return()=>clearInterval(e)}},[t.challenge]);let y=e=>{b.G.getUserChallengesByChallengeId(e).then(e=>{let{userChallenges:t,error:s}=e;if(s){console.error("Error fetching participants:",s);return}n(t);let a=D.W4.currentUser?.id;a&&d(t.find(e=>e.userId===a)||null)}).catch(e=>console.error("Error fetching participants:",e))};return(0,c.useEffect)(()=>{a&&a.ownerId&&a.ownerId.length>0&&D.W4.getUsersByIds(a.ownerId).then(m).catch(e=>console.error("Error fetching hosts:",e))},[a]),(0,c.useEffect)(()=>{t.fetchChatMessages(),a.id&&y(a.id)},[a,t]),(0,i.jsxs)("div",{className:"min-h-screen bg-[#141A1E] text-white",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between p-4",children:[(0,i.jsx)("div",{className:"flex-shrink-0 cursor-pointer",onClick:()=>p.push("/"),children:(0,i.jsx)("img",{src:"/pulse-logo-white.svg",alt:"Pulse Logo",className:"h-8 mx-auto mb-8"})}),(0,i.jsx)("div",{className:"w-6"})]}),(0,i.jsxs)("div",{className:"px-4 pb-8",children:[(0,i.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,i.jsx)("div",{className:"relative",children:(0,i.jsx)("div",{className:"w-20 h-20 rounded-full bg-[#DFFD10] bg-opacity-15 flex items-center justify-center",children:(0,i.jsx)(z.Z,{className:"h-5 w-5 text-[#DFFD10]"})})}),(0,i.jsxs)("div",{className:"text-center space-y-1",children:[(0,i.jsx)("p",{className:"font-bold text-[#DFFD10] uppercase text-sm",children:"Welcome"}),(0,i.jsx)("h1",{className:"text-3xl font-extrabold",children:t.challenge?.title||"the Round"}),t.challenge?.subtitle&&(0,i.jsx)("p",{className:"text-base text-gray-400",children:t.challenge.subtitle})]})]}),(0,i.jsxs)("div",{className:"mt-8",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(F.Z,{className:"h-5 w-5 text-[#DFFD10]"}),(0,i.jsx)("p",{className:"text-sm text-gray-400",children:"Hosted by"})]}),(0,i.jsx)("div",{className:"mt-2 overflow-x-auto",children:(0,i.jsx)("div",{className:"flex space-x-4",children:o.map(e=>(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)("img",{src:e.profileImage?.profileImageURL||"/default-profile.png",alt:e.username,className:"w-12 h-12 rounded-full object-cover"}),(0,i.jsxs)("p",{className:"text-xs text-gray-300",children:["@",e.username]})]},e.id))})})]}),(0,i.jsx)("div",{className:"mt-8 p-4 bg-gray-800 rounded-lg text-center",children:t.challenge?.status===h.Dj.Draft?(0,i.jsxs)("div",{children:[(0,i.jsx)("h2",{className:"text-lg font-semibold",children:"THE WAITING ROOM"}),(0,i.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,i.jsx)(T.Z,{className:"h-5 w-5 text-[#DFFD10]"}),(0,i.jsx)("h2",{className:"text-lg font-semibold",children:"Round is being prepared"})]}),null===r?(0,i.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"Join now to be notified when the round begins and connect with other challengers!"}):(0,i.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"Thanks for joining! Sit tight, we'll notify you when the round begins."})]}):(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,i.jsx)("span",{className:"material-icons text-[#DFFD10]",children:"access_time"}),(0,i.jsx)("h2",{className:"text-lg font-semibold",children:"Round starts in"})]}),(0,i.jsxs)("div",{className:"flex justify-center space-x-6 mt-4",children:[(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)("p",{className:"text-3xl font-bold text-[#DFFD10]",children:x.days}),(0,i.jsx)("p",{className:"text-sm text-gray-400",children:"Days"})]}),(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)("p",{className:"text-3xl font-bold text-[#DFFD10]",children:x.hours}),(0,i.jsx)("p",{className:"text-sm text-gray-400",children:"Hours"})]}),(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)("p",{className:"text-3xl font-bold text-[#DFFD10]",children:x.minutes}),(0,i.jsx)("p",{className:"text-sm text-gray-400",children:"Minutes"})]})]}),null===r?(0,i.jsx)("p",{className:"text-sm text-gray-400 mt-4",children:"Get ready! Join now to meet your fellow challengers."}):(0,i.jsx)("p",{className:"text-sm text-gray-400 mt-4",children:"Thanks for joining! We'll notify you when the round begins."})]})}),(0,i.jsxs)("div",{className:"mt-8",children:[(0,i.jsx)("div",{className:"flex items-center justify-between px-2",children:(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(F.Z,{className:"h-5 w-5 text-[#DFFD10]"}),(0,i.jsx)("h2",{className:"text-lg font-semibold",children:"Who's joining"}),(0,i.jsxs)("span",{className:"text-sm text-[#DFFD10]",children:["(",l.length," challengers)"]})]})}),(0,i.jsx)("div",{className:"mt-4 overflow-x-auto",children:(0,i.jsxs)("div",{className:"flex space-x-4 px-2",children:[null===r&&(0,i.jsxs)("button",{onClick:()=>{t.challenge&&t.joinChallenge(t.challenge,e=>{if(e){n(t=>[...t,e]),d(e);let s={...t.challenge,participants:[...t.challenge?.participants||[],e]},l=new h.No({id:a.id,title:a.title,subtitle:a.subtitle,challenge:s,sweatlistIds:a.sweatlistIds,ownerId:a.ownerId,createdAt:a.createdAt,updatedAt:a.updatedAt});b.G.updateCollection(l).then(()=>{}).catch(e=>{console.error(e)})}})},className:"flex flex-col items-center p-4 bg-gray-700 rounded-lg border border-[#DFFD10] hover:bg-gray-600 transition-colors",children:[(0,i.jsx)("div",{className:"w-12 h-12 rounded-full border-2 border-[#DFFD10] flex items-center justify-center",children:(0,i.jsx)("span",{className:"material-icons text-[#DFFD10]",children:"add"})}),(0,i.jsx)("p",{className:"text-xs mt-2 text-[#DFFD10]",children:"Join Round"})]}),l.map(e=>(0,i.jsxs)("div",{className:"flex flex-col items-center p-4 bg-gray-700 rounded-lg border border-gray-700",children:[e.profileImage?.profileImageURL?(0,i.jsx)("img",{src:e.profileImage.profileImageURL,alt:e.username,className:"w-12 h-12 rounded-full object-cover border-2 border-[#DFFD10]"}):(0,i.jsx)("div",{className:"w-12 h-12 rounded-full bg-[#DFFD10] flex items-center justify-center",children:(0,i.jsx)("span",{className:"text-white text-lg",children:e.username.charAt(0).toUpperCase()})}),(0,i.jsxs)("p",{className:"text-xs mt-2 text-gray-300",children:["@",e.username]})]},e.id))]})})]})]})]})};var R=()=>{let e=(0,k.useRouter)(),{id:t}=e.query,[s,a]=(0,c.useState)(null),[l,r]=(0,c.useState)([]),[x,u]=(0,c.useState)(!0),[f,p]=(0,c.useState)(null),[j,y]=(0,c.useState)(!1),[w,v]=(0,c.useState)(!1),[I,M]=(0,c.useState)(null),[E,z]=(0,c.useState)([]),[F,T]=(0,c.useState)(0),[R,Z]=(0,c.useState)(!0),[A,$]=(0,c.useState)(!0),[L,P]=(0,c.useState)([]),{currentUser:B}=(0,C.v9)(e=>e.user);(0,c.useEffect)(()=>{s&&s.ownerId&&s.ownerId.length>0&&D.W4.getUsersByIds(s.ownerId).then(P).catch(e=>console.error("Error fetching hosts:",e))},[s]),(0,c.useEffect)(()=>{(async()=>{if(s?.challenge?.id)try{let e=await S.getInstance().fetchChallengeMessages(s.challenge.id);z(e),O(e)}catch(e){console.error("Error fetching messages:",e)}})();let e=H();return()=>e()},[s?.challenge?.id]),(0,c.useEffect)(()=>{if(s?.challenge?.id&&B){let e=E.filter(e=>!e.readBy[B.id]);e.length>0&&S.getInstance().markMessagesAsRead(s.challenge.id,B.id,e.map(e=>e.id))}},[E,s?.challenge?.id,B]),(0,c.useEffect)(()=>{let s=async()=>{if(t)try{let e=await b.G.getCollectionById(t);if(console.log("this is the collection data:",{...e}),!e||!e.challenge)throw Error("Invalid challenge data received");a(e),await _(e),e.challenge.id&&await W(e.challenge.id)}catch(e){p(e instanceof Error?e.message:"An error occurred")}finally{u(!1)}};e.isReady&&t&&s()},[t,e.isReady]);let H=()=>S.getInstance().subscribeToMessages(s?.challenge?.id||"",e=>{z(e),O(e)}),O=e=>{T(e.filter(e=>!e.readBy[B?.id||""]).length)},W=async e=>{if(!e)return;$(!0);let t=0,s=async()=>{try{let t=await b.G.fetchUserChallengesByChallengeId(e);M(t)}catch(e){console.error(`Error fetching user challenge (attempt ${t+1}):`,e),t<3?(t++,await new Promise(e=>setTimeout(e,1e3*t)),await s()):(console.error("Max retries reached. Failed to fetch user challenge."),p("Failed to load participants. Please try refreshing the page."))}finally{$(!1)}};await s()},_=async e=>{let t=e.sweatlistIds,s=(t=t.map(e=>"rest"!==e.id||e.sweatlistAuthorId?e:{...e,sweatlistAuthorId:D.W4.currentUser?.id||"default_author"})).reduce((e,t)=>{let s=t.sweatlistAuthorId;return e[s]||(e[s]=[]),e[s].push(t),e},{});try{let e=[];await Promise.all(Object.entries(s).map(async t=>{let[s,a]=t;if(!s)return;let l=await b.G.getAllSweatlists(s);a.forEach(t=>{if("Rest"===t.sweatlistName){let s=new h.oQ({id:"rest",roundWorkoutId:"rest",title:"Rest Day",description:"Recovery day",author:t.sweatlistAuthorId,exercises:[],logs:[],duration:0,useAuthorContent:!0,isCompleted:!1,workoutStatus:h.Z0.QueuedUp,createdAt:new Date,updatedAt:new Date,zone:h.Bc.FullBody,collectionId:[],challenge:void 0,startTime:void 0,order:0,workoutRating:void 0});e.push(s)}else{let s=l?.find(e=>e.id===t.id);s&&(Array.isArray(s.exercises)&&s.exercises.forEach((e,t)=>{e&&e.exercise}),e.push(s))}})})),r(e)}catch(e){console.error("Error fetching workouts:",e),p("Failed to fetch workouts")}},G=e=>new Date("number"==typeof e?1e3*e:e).toLocaleDateString("en-US",{month:"short",day:"numeric"}),V=()=>{if(!s?.challenge?.startDate||!s?.challenge?.endDate)return 0;let e=new Date(s.challenge.startDate),t=new Date(s.challenge.endDate),a=new Date,l=t.getTime()-e.getTime();return Math.min(Math.max((a.getTime()-e.getTime())/l,0),1)},J=async(e,t)=>{try{s&&await _(s)}catch(e){console.error("Failed to update workout order:",e)}},q=async(e,t)=>{},Q=async(e,t)=>{if(s?.challenge?.id&&B)try{let a=null;if(t&&!(a=await S.getInstance().uploadMedia(t))){console.error("Failed to upload image");return}let l={sender:B.toShortUser(),content:e,timestamp:new Date,readBy:{},mediaURL:a,mediaType:t?n.Image:n.None,checkinId:null,gymName:null};await S.getInstance().sendMessage(s.challenge.id,l)}catch(e){console.error("Failed to send message:",e)}};if(x)return(0,i.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:"Loading..."});if(f)return(0,i.jsx)("div",{className:"flex items-center justify-center min-h-screen text-red-500",children:f});let X=(()=>{if(!s?.challenge?.startDate||!s?.challenge?.endDate)return null;let e=new Date(s.challenge.startDate),t=new Date(s.challenge.endDate),a=new Date;return a<e?{type:"until-start",days:Math.ceil((e.getTime()-a.getTime())/864e5)}:a<t?{type:"remaining",days:Math.ceil((t.getTime()-a.getTime())/864e5)}:{type:"ended",days:0}})();V();let K=!!s?.challenge?.startDate&&new Date>=new Date(s.challenge.startDate);if(s&&B&&!s.ownerId.includes(B.id)&&(s.challenge?.status===h.Dj.Draft||!K)){let e={challenge:s.challenge,challengeDetailViewModel:{collection:s},fetchChatMessages:()=>{S.getInstance().fetchChallengeMessages(s.challenge.id).then(()=>{}).catch(e=>console.error(e))},joinChallenge:(e,t)=>{b.G.joinChallenge({username:B.username,challengeId:e.id}).then(()=>{t(null)}).catch(e=>{console.error(e),t(null)})}};return(0,i.jsx)(U,{viewModel:e,initialParticipants:I||[]})}return(0,i.jsxs)("div",{className:"min-h-screen bg-zinc-900",children:[(0,i.jsx)("div",{className:"h-48 bg-gradient-to-b from-zinc-800 to-zinc-900"}),(0,i.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,i.jsx)("div",{className:"relative -mt-24",children:(0,i.jsxs)("div",{className:"mt-4 text-white",children:[(0,i.jsxs)("div",{className:"flex justify-between items-start",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-2xl font-bold",children:s?.challenge?.title}),(0,i.jsx)("p",{className:"text-zinc-400 mt-1",children:s?.challenge?.subtitle})]}),(0,i.jsx)("button",{onClick:()=>y(!j),className:"p-2 hover:bg-zinc-800 rounded-full transition-colors",children:(0,i.jsx)(d.Z,{className:"h-5 w-5 text-white"})})]}),(0,i.jsxs)("div",{className:"mt-6 grid grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{className:"bg-zinc-800 rounded-xl p-4",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2 text-zinc-400 mb-2",children:[(0,i.jsx)(o.Z,{className:"h-4 w-4"}),(0,i.jsx)("span",{className:"text-sm",children:"Starts"})]}),(0,i.jsx)("div",{className:"text-lg font-semibold",children:s?.challenge?.startDate?G(s.challenge.startDate):"TBD"})]}),(0,i.jsxs)("div",{className:"bg-zinc-800 rounded-xl p-4",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2 text-zinc-400 mb-2",children:[(0,i.jsx)(o.Z,{className:"h-4 w-4"}),(0,i.jsx)("span",{className:"text-sm",children:"Ends"})]}),(0,i.jsx)("div",{className:"text-lg font-semibold",children:s?.challenge?.endDate?G(s.challenge.endDate):"TBD"})]})]}),L.length>0&&(0,i.jsxs)("div",{className:"mt-4",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Hosted by"}),(0,i.jsx)("div",{className:"flex space-x-4 mt-2 overflow-x-auto",children:L.map(e=>(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)("img",{src:e.profileImage.profileImageURL,alt:e.username,className:"w-10 h-10 rounded-full object-cover"}),(0,i.jsxs)("span",{className:"text-sm text-gray-300",children:["@",e.username]})]},e.id))})]}),(0,i.jsxs)("div",{className:"mt-6 bg-zinc-800 rounded-xl p-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold",children:"Challenge Progress"}),X&&(0,i.jsx)("div",{className:"text-sm text-[#E0FE10]",children:"until-start"===X.type?(0,i.jsxs)("span",{children:["Starts in ",X.days,"d"]}):"remaining"===X.type?(0,i.jsxs)("span",{children:[X.days,"d left"]}):(0,i.jsx)("span",{children:"Challenge ended"})})]}),(0,i.jsx)("div",{className:"relative h-2 bg-zinc-700 rounded-full overflow-hidden",children:(0,i.jsx)("div",{className:"absolute h-full bg-[#E0FE10] rounded-full transition-all duration-500 ease-in-out",style:{width:`${100*V()}%`}})}),(0,i.jsxs)("div",{className:"mt-4 grid grid-cols-3 gap-4 text-center",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"text-2xl font-bold",children:[Math.round(100*V()),"%"]}),(0,i.jsx)("div",{className:"text-sm text-zinc-400",children:"Complete"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-2xl font-bold",children:l.length}),(0,i.jsx)("div",{className:"text-sm text-zinc-400",children:"Workouts"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"text-2xl font-bold",children:I?.length||0}),(0,i.jsx)("div",{className:"text-sm text-zinc-400",children:"Participants"})]})]})]}),(0,i.jsx)(g,{participants:I||[],onParticipantClick:t=>{e.push(`/profile/${t.username}`)}}),s&&(0,i.jsx)("div",{className:"mt-8",children:R?(0,i.jsx)(N,{participants:s.challenge?.participants||[],messages:E,onSendMessage:Q,currentUser:B,onCollapse:()=>{Z(!R)}}):(0,i.jsx)(i.Fragment,{})}),(0,i.jsxs)("div",{className:"mt-8",children:[(0,i.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,i.jsx)("h2",{className:"text-lg font-semibold",children:"Stacks in this Round"})}),(0,i.jsx)("div",{className:"space-y-4",children:l.map((t,a)=>{let n=s?.challenge?.startDate?new Date(new Date(s.challenge.startDate).getTime()+864e5*a):new Date,r=s?.challenge?.startDate?(()=>{let e=new Date(s.challenge.startDate);e.setHours(0,0,0,0);let t=new Date;return t.setHours(0,0,0,0),Math.floor(Math.abs(t.getTime()-e.getTime())/864e5)})():0;return"rest"===t.id?(0,i.jsx)(m.ox,{selectedOrder:a,maxOrder:l.length,showArrows:w,showCalendar:!0,workoutDate:n,isComplete:!1,challengeStartDate:s?.challenge?.startDate,challengeHasStarted:s?.challenge?.status===h.Dj.Published&&new Date>=new Date(s?.challenge?.startDate||0),currentDayIndex:r,index:a,onPrimaryAction:()=>console.log("Rest day clicked"),onCalendarTap:e=>console.log("Rest day calendar tapped:",e),onUpdateOrder:e=>J(t,e)},`rest-${a}`):(0,i.jsx)(m.kg,{workout:t,gifUrls:t.exercises?.map(e=>e.exercise?.videos?.[0]?.gifURL||"")||[],selectedOrder:a,maxOrder:l.length,showArrows:w,showCalendar:!0,workoutDate:n,isComplete:!1,isChallengeEnabled:!0,challengeStartDate:s?.challenge?.startDate,challengeHasStarted:s?.challenge?.status===h.Dj.Published&&new Date>=new Date(s?.challenge?.startDate||0),currentDayIndex:r,userChallenge:I?.find(e=>e.userId===B?.id),allWorkoutSummaries:[],index:a,onPrimaryAction:async()=>{try{let s=await D.W4.getUserById(t.author);e.push(`/workout/${s.username}/${t.id}`)}catch(e){console.error("Error getting user:",e)}},onCalendarTap:e=>q(t,e),onUpdateOrder:e=>J(t,e)},t.id)})})]})]})})})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=3212)}),_N_E=e.O()}]);
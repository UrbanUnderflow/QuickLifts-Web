"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("pages/_app",{

/***/ "./src/api/firebase/storage/service.ts":
/*!*********************************************!*\
  !*** ./src/api/firebase/storage/service.ts ***!
  \*********************************************/
/***/ (function(module, __webpack_exports__, __webpack_require__) {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   FirebaseStorageService: function() { return /* binding */ FirebaseStorageService; },\n/* harmony export */   UploadImageType: function() { return /* binding */ UploadImageType; },\n/* harmony export */   VideoTrimmerService: function() { return /* binding */ VideoTrimmerService; },\n/* harmony export */   VideoType: function() { return /* binding */ VideoType; },\n/* harmony export */   firebaseStorageService: function() { return /* binding */ firebaseStorageService; },\n/* harmony export */   videoTrimmerService: function() { return /* binding */ videoTrimmerService; }\n/* harmony export */ });\n/* harmony import */ var _swc_helpers_async_to_generator__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @swc/helpers/_/_async_to_generator */ \"./node_modules/@swc/helpers/esm/_async_to_generator.js\");\n/* harmony import */ var _swc_helpers_class_call_check__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @swc/helpers/_/_class_call_check */ \"./node_modules/@swc/helpers/esm/_class_call_check.js\");\n/* harmony import */ var _swc_helpers_object_spread__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! @swc/helpers/_/_object_spread */ \"./node_modules/@swc/helpers/esm/_object_spread.js\");\n/* harmony import */ var _swc_helpers_object_spread_props__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! @swc/helpers/_/_object_spread_props */ \"./node_modules/@swc/helpers/esm/_object_spread_props.js\");\n/* harmony import */ var _swc_helpers_ts_generator__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @swc/helpers/_/_ts_generator */ \"./node_modules/@swc/helpers/esm/_ts_generator.js\");\n/* harmony import */ var firebase_storage__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! firebase/storage */ \"./node_modules/firebase/storage/dist/esm/index.esm.js\");\n/* harmony import */ var _api_firebase_user__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../api/firebase/user */ \"./src/api/firebase/user/index.ts\");\n/* harmony import */ var _api_firebase_config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../api/firebase/config */ \"./src/api/firebase/config.ts\");\n// src/services/FirebaseStorageService.ts\n\n\n\n\n\n\n\n\n\nvar UploadImageType;\n(function(UploadImageType) {\n    UploadImageType[\"Profile\"] = \"profile_images\";\n    UploadImageType[\"Feedback\"] = \"feedback\";\n    UploadImageType[\"CheckIn\"] = \"checkin\";\n    UploadImageType[\"Meal\"] = \"meal\";\n    UploadImageType[\"GroupChat\"] = \"group_chat\";\n})(UploadImageType || (UploadImageType = {}));\nvar VideoType;\n(function(VideoType) {\n    VideoType[\"Exercise\"] = \"exercise\";\n    VideoType[\"Intro\"] = \"intro\";\n    VideoType[\"RoundChat\"] = \"round-chat\";\n})(VideoType || (VideoType = {}));\nvar FirebaseStorageService = /*#__PURE__*/ function() {\n    \"use strict\";\n    function FirebaseStorageService() {\n        (0,_swc_helpers_class_call_check__WEBPACK_IMPORTED_MODULE_3__._)(this, FirebaseStorageService);\n        this.storage = (0,firebase_storage__WEBPACK_IMPORTED_MODULE_0__.getStorage)();\n        // Optional: Image caching similar to iOS implementation\n        this.imageCache = new Map();\n    }\n    var _proto = FirebaseStorageService.prototype;\n    _proto.uploadVideo = function uploadVideo(file) {\n        var videoType = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : \"exercise\";\n        return (0,_swc_helpers_async_to_generator__WEBPACK_IMPORTED_MODULE_4__._)(function() {\n            var user, ALLOWED_TYPES, MAX_FILE_SIZE, fileName, storagePath, storageRef, snapshot, downloadURL, gsURL, error;\n            return (0,_swc_helpers_ts_generator__WEBPACK_IMPORTED_MODULE_5__._)(this, function(_state) {\n                switch(_state.label){\n                    case 0:\n                        // Ensure user is authenticated\n                        user = _api_firebase_config__WEBPACK_IMPORTED_MODULE_2__.auth.currentUser;\n                        if (!user) {\n                            throw new Error(\"User must be authenticated to upload video\");\n                        }\n                        // Validate file type and size\n                        ALLOWED_TYPES = [\n                            \"video/mp4\",\n                            \"video/quicktime\",\n                            \"video/x-msvideo\"\n                        ];\n                        MAX_FILE_SIZE = 100 * 1024 * 1024; // 100MB\n                        if (!ALLOWED_TYPES.includes(file.type)) {\n                            throw new Error(\"Invalid file type. Only MP4, AVI, and QuickTime videos are allowed.\");\n                        }\n                        if (file.size > MAX_FILE_SIZE) {\n                            throw new Error(\"File is too large. Maximum size is 100MB.\");\n                        }\n                        // Generate unique filename\n                        fileName = \"\".concat(Date.now(), \"_\").concat(file.name);\n                        storagePath = \"videos/\".concat(user.uid, \"/\").concat(fileName);\n                        // Create storage reference\n                        storageRef = (0,firebase_storage__WEBPACK_IMPORTED_MODULE_0__.ref)((0,firebase_storage__WEBPACK_IMPORTED_MODULE_0__.getStorage)(), storagePath);\n                        _state.label = 1;\n                    case 1:\n                        _state.trys.push([\n                            1,\n                            4,\n                            ,\n                            5\n                        ]);\n                        return [\n                            4,\n                            (0,firebase_storage__WEBPACK_IMPORTED_MODULE_0__.uploadBytes)(storageRef, file)\n                        ];\n                    case 2:\n                        snapshot = _state.sent();\n                        return [\n                            4,\n                            (0,firebase_storage__WEBPACK_IMPORTED_MODULE_0__.getDownloadURL)(snapshot.ref)\n                        ];\n                    case 3:\n                        downloadURL = _state.sent();\n                        // Construct GS URL (Google Storage URL)\n                        gsURL = \"gs://\".concat(snapshot.ref.bucket, \"/\").concat(snapshot.ref.fullPath);\n                        return [\n                            2,\n                            {\n                                gsURL: gsURL,\n                                downloadURL: downloadURL\n                            }\n                        ];\n                    case 4:\n                        error = _state.sent();\n                        console.error(\"Video upload failed\", error);\n                        throw error;\n                    case 5:\n                        return [\n                            2\n                        ];\n                }\n            });\n        })();\n    };\n    _proto.uploadImage = function uploadImage(file) {\n        var imageType = arguments.length > 1 && arguments[1] !== void 0 ? arguments[1] : \"profile_images\";\n        var _this = this;\n        return (0,_swc_helpers_async_to_generator__WEBPACK_IMPORTED_MODULE_4__._)(function() {\n            var user, fileName, storagePath, storageRef, snapshot, downloadURL, gsURL, error;\n            return (0,_swc_helpers_ts_generator__WEBPACK_IMPORTED_MODULE_5__._)(this, function(_state) {\n                switch(_state.label){\n                    case 0:\n                        // Ensure user is authenticated\n                        user = _api_firebase_config__WEBPACK_IMPORTED_MODULE_2__.auth.currentUser;\n                        if (!user) {\n                            throw new Error(\"User must be authenticated to upload image\");\n                        }\n                        // Generate unique filename\n                        fileName = \"\".concat(Date.now(), \"_\").concat(file.name);\n                        storagePath = \"\".concat(imageType, \"/\").concat(user.uid, \"/\").concat(fileName);\n                        // Create storage reference\n                        storageRef = (0,firebase_storage__WEBPACK_IMPORTED_MODULE_0__.ref)(_this.storage, storagePath);\n                        _state.label = 1;\n                    case 1:\n                        _state.trys.push([\n                            1,\n                            6,\n                            ,\n                            7\n                        ]);\n                        return [\n                            4,\n                            (0,firebase_storage__WEBPACK_IMPORTED_MODULE_0__.uploadBytes)(storageRef, file)\n                        ];\n                    case 2:\n                        snapshot = _state.sent();\n                        return [\n                            4,\n                            (0,firebase_storage__WEBPACK_IMPORTED_MODULE_0__.getDownloadURL)(snapshot.ref)\n                        ];\n                    case 3:\n                        downloadURL = _state.sent();\n                        // Construct GS URL (Google Storage URL)\n                        gsURL = \"gs://\".concat(snapshot.ref.bucket, \"/\").concat(snapshot.ref.fullPath);\n                        if (!(imageType === \"profile_images\")) return [\n                            3,\n                            5\n                        ];\n                        return [\n                            4,\n                            _this.updateUserProfileImage(downloadURL)\n                        ];\n                    case 4:\n                        _state.sent();\n                        _state.label = 5;\n                    case 5:\n                        return [\n                            2,\n                            {\n                                gsURL: gsURL,\n                                downloadURL: downloadURL\n                            }\n                        ];\n                    case 6:\n                        error = _state.sent();\n                        console.error(\"Image upload failed\", error);\n                        throw error;\n                    case 7:\n                        return [\n                            2\n                        ];\n                }\n            });\n        })();\n    };\n    _proto.updateUserProfileImage = function updateUserProfileImage(imageURL) {\n        return (0,_swc_helpers_async_to_generator__WEBPACK_IMPORTED_MODULE_4__._)(function() {\n            var updatedUser;\n            return (0,_swc_helpers_ts_generator__WEBPACK_IMPORTED_MODULE_5__._)(this, function(_state) {\n                switch(_state.label){\n                    case 0:\n                        // Ensure current user exists\n                        if (!_api_firebase_user__WEBPACK_IMPORTED_MODULE_1__.userService.currentUser) {\n                            throw new Error(\"No current user found\");\n                        }\n                        // Create a new User object with updated profile image\n                        updatedUser = new _api_firebase_user__WEBPACK_IMPORTED_MODULE_1__.User((0,_swc_helpers_object_spread_props__WEBPACK_IMPORTED_MODULE_6__._)((0,_swc_helpers_object_spread__WEBPACK_IMPORTED_MODULE_7__._)({}, _api_firebase_user__WEBPACK_IMPORTED_MODULE_1__.userService.currentUser.toDictionary()), {\n                            profileImage: {\n                                profileImageURL: imageURL,\n                                imageOffsetWidth: 0,\n                                imageOffsetHeight: 0\n                            },\n                            updatedAt: new Date()\n                        }));\n                        // Update user in Firestore\n                        return [\n                            4,\n                            _api_firebase_user__WEBPACK_IMPORTED_MODULE_1__.userService.updateUser(updatedUser.id, updatedUser)\n                        ];\n                    case 1:\n                        _state.sent();\n                        return [\n                            2\n                        ];\n                }\n            });\n        })();\n    };\n    _proto.fetchImage = function fetchImage(url) {\n        var _this = this;\n        return (0,_swc_helpers_async_to_generator__WEBPACK_IMPORTED_MODULE_4__._)(function() {\n            var response, blob, imageURL, error;\n            return (0,_swc_helpers_ts_generator__WEBPACK_IMPORTED_MODULE_5__._)(this, function(_state) {\n                switch(_state.label){\n                    case 0:\n                        // Check cache first\n                        if (_this.imageCache.has(url)) {\n                            return [\n                                2,\n                                _this.imageCache.get(url)\n                            ];\n                        }\n                        _state.label = 1;\n                    case 1:\n                        _state.trys.push([\n                            1,\n                            4,\n                            ,\n                            5\n                        ]);\n                        return [\n                            4,\n                            fetch(url)\n                        ];\n                    case 2:\n                        response = _state.sent();\n                        return [\n                            4,\n                            response.blob()\n                        ];\n                    case 3:\n                        blob = _state.sent();\n                        imageURL = URL.createObjectURL(blob);\n                        // Cache the image URL\n                        _this.imageCache.set(url, imageURL);\n                        return [\n                            2,\n                            imageURL\n                        ];\n                    case 4:\n                        error = _state.sent();\n                        console.error(\"Image fetch failed\", error);\n                        throw error;\n                    case 5:\n                        return [\n                            2\n                        ];\n                }\n            });\n        })();\n    };\n    return FirebaseStorageService;\n}();\n// In FirebaseStorageService.ts, update the VideoTrimmerService class\nvar VideoTrimmerService = /*#__PURE__*/ function() {\n    \"use strict\";\n    function VideoTrimmerService() {\n        (0,_swc_helpers_class_call_check__WEBPACK_IMPORTED_MODULE_3__._)(this, VideoTrimmerService);\n    }\n    var _proto = VideoTrimmerService.prototype;\n    _proto.trimVideo = function trimVideo(file, startTime, endTime, onProgress) {\n        return new Promise(function(resolve, reject) {\n            var video = document.createElement(\"video\");\n            var canvas = document.createElement(\"canvas\");\n            var ctx = canvas.getContext(\"2d\");\n            if (!ctx) {\n                return reject(new Error(\"Unable to get canvas context\"));\n            }\n            var chunks = [];\n            video.src = URL.createObjectURL(file);\n            video.onloadedmetadata = function() {\n                canvas.width = video.videoWidth;\n                canvas.height = video.videoHeight;\n                video.currentTime = startTime;\n            };\n            // Wait until the video has seeked to startTime before starting recording\n            video.onseeked = function() {\n                var stream = canvas.captureStream();\n                var mediaRecorder = new MediaRecorder(stream);\n                mediaRecorder.ondataavailable = function(e) {\n                    if (e.data.size > 0) {\n                        chunks.push(e.data);\n                    }\n                };\n                mediaRecorder.onstop = function() {\n                    var _chunks_;\n                    var blob = new Blob(chunks, {\n                        type: ((_chunks_ = chunks[0]) === null || _chunks_ === void 0 ? void 0 : _chunks_.type) || \"video/webm\"\n                    });\n                    // Force the file type to \"video/webm\" so it passes the allowed formats check\n                    var trimmedFile = new File([\n                        blob\n                    ], file.name, {\n                        type: \"video/webm\"\n                    });\n                    URL.revokeObjectURL(video.src);\n                    resolve(trimmedFile);\n                };\n                mediaRecorder.start();\n                video.play();\n                video.ontimeupdate = function() {\n                    if (video.currentTime >= endTime) {\n                        mediaRecorder.stop();\n                        video.pause();\n                    } else {\n                        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n                        if (onProgress) {\n                            onProgress((video.currentTime - startTime) / (endTime - startTime));\n                        }\n                    }\n                };\n            };\n            video.onerror = function() {\n                reject(new Error(\"Error loading video\"));\n            };\n        });\n    };\n    return VideoTrimmerService;\n}();\nvar videoTrimmerService = new VideoTrimmerService();\n// Create a singleton instance\nvar firebaseStorageService = new FirebaseStorageService();\n\n\n;\n    // Wrapped in an IIFE to avoid polluting the global scope\n    ;\n    (function () {\n        var _a, _b;\n        // Legacy CSS implementations will `eval` browser code in a Node.js context\n        // to extract CSS. For backwards compatibility, we need to check we're in a\n        // browser context before continuing.\n        if (typeof self !== 'undefined' &&\n            // AMP / No-JS mode does not inject these helpers:\n            '$RefreshHelpers$' in self) {\n            // @ts-ignore __webpack_module__ is global\n            var currentExports = module.exports;\n            // @ts-ignore __webpack_module__ is global\n            var prevSignature = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevSignature) !== null && _b !== void 0 ? _b : null;\n            // This cannot happen in MainTemplate because the exports mismatch between\n            // templating and execution.\n            self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n            // A module can be accepted automatically based on its exports, e.g. when\n            // it is a Refresh Boundary.\n            if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n                // Save the previous exports signature on update so we can compare the boundary\n                // signatures. We avoid saving exports themselves since it causes memory leaks (https://github.com/vercel/next.js/pull/53797)\n                module.hot.dispose(function (data) {\n                    data.prevSignature =\n                        self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports);\n                });\n                // Unconditionally accept an update to this module, we'll check if it's\n                // still a Refresh Boundary later.\n                // @ts-ignore importMeta is replaced in the loader\n                module.hot.accept();\n                // This field is set when the previous version of this module was a\n                // Refresh Boundary, letting us know we need to check for invalidation or\n                // enqueue an update.\n                if (prevSignature !== null) {\n                    // A boundary can become ineligible if its exports are incompatible\n                    // with the previous exports.\n                    //\n                    // For example, if you add/remove/change exports, we'll want to\n                    // re-execute the importing modules, and force those components to\n                    // re-render. Similarly, if you convert a class component to a\n                    // function, we want to invalidate the boundary.\n                    if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevSignature, self.$RefreshHelpers$.getRefreshBoundarySignature(currentExports))) {\n                        module.hot.invalidate();\n                    }\n                    else {\n                        self.$RefreshHelpers$.scheduleUpdate();\n                    }\n                }\n            }\n            else {\n                // Since we just executed the code for the module, it's possible that the\n                // new exports made it ineligible for being a boundary.\n                // We only care about the case when we were _previously_ a boundary,\n                // because we already accepted this update (accidental side effect).\n                var isNoLongerABoundary = prevSignature !== null;\n                if (isNoLongerABoundary) {\n                    module.hot.invalidate();\n                }\n            }\n        }\n    })();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ZWJhc2Uvc3RvcmFnZS9zZXJ2aWNlLnRzPzYyMWQiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3NlcnZpY2VzL0ZpcmViYXNlU3RvcmFnZVNlcnZpY2UudHNcbmltcG9ydCB7IGdldFN0b3JhZ2UsIHJlZiwgdXBsb2FkQnl0ZXMsIGdldERvd25sb2FkVVJMIH0gZnJvbSBcImZpcmViYXNlL3N0b3JhZ2VcIjtcbmltcG9ydCB7IFVzZXIgfSBmcm9tIFwiLi4vLi4vLi4vYXBpL2ZpcmViYXNlL3VzZXJcIjtcbmltcG9ydCB7IHVzZXJTZXJ2aWNlIH0gZnJvbSBcIi4uLy4uLy4uL2FwaS9maXJlYmFzZS91c2VyXCI7XG5pbXBvcnQgeyBhdXRoIH0gZnJvbSBcIi4uLy4uLy4uL2FwaS9maXJlYmFzZS9jb25maWdcIjtcblxuZXhwb3J0IGVudW0gVXBsb2FkSW1hZ2VUeXBlIHtcbiAgUHJvZmlsZSA9IFwicHJvZmlsZV9pbWFnZXNcIixcbiAgRmVlZGJhY2sgPSBcImZlZWRiYWNrXCIsXG4gIENoZWNrSW4gPSBcImNoZWNraW5cIixcbiAgTWVhbCA9IFwibWVhbFwiLFxuICBHcm91cENoYXQgPSBcImdyb3VwX2NoYXRcIlxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwbG9hZFJlc3VsdCB7XG4gIGdzVVJMOiBzdHJpbmc7XG4gIGRvd25sb2FkVVJMOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjb25zdCBlbnVtIFZpZGVvVHlwZSB7XG4gICAgRXhlcmNpc2UgPSBcImV4ZXJjaXNlXCIsXG4gICAgSW50cm8gPSBcImludHJvXCIsXG4gICAgUm91bmRDaGF0ID0gXCJyb3VuZC1jaGF0XCJcbn1cblxuZXhwb3J0IGNsYXNzIEZpcmViYXNlU3RvcmFnZVNlcnZpY2Uge1xuICBwcml2YXRlIHN0b3JhZ2UgPSBnZXRTdG9yYWdlKCk7XG5cbiAgYXN5bmMgdXBsb2FkVmlkZW8oXG4gICAgICBmaWxlOiBGaWxlLCBcbiAgICAgIHZpZGVvVHlwZTogVmlkZW9UeXBlID0gVmlkZW9UeXBlLkV4ZXJjaXNlXG4gICAgKTogUHJvbWlzZTxVcGxvYWRSZXN1bHQ+IHtcbiAgICAgIC8vIEVuc3VyZSB1c2VyIGlzIGF1dGhlbnRpY2F0ZWRcbiAgICAgIGNvbnN0IHVzZXIgPSBhdXRoLmN1cnJlbnRVc2VyO1xuICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVzZXIgbXVzdCBiZSBhdXRoZW50aWNhdGVkIHRvIHVwbG9hZCB2aWRlb1wiKTtcbiAgICAgIH1cbiAgXG4gICAgICAvLyBWYWxpZGF0ZSBmaWxlIHR5cGUgYW5kIHNpemVcbiAgICAgIGNvbnN0IEFMTE9XRURfVFlQRVMgPSBbJ3ZpZGVvL21wNCcsICd2aWRlby9xdWlja3RpbWUnLCAndmlkZW8veC1tc3ZpZGVvJ107XG4gICAgICBjb25zdCBNQVhfRklMRV9TSVpFID0gMTAwICogMTAyNCAqIDEwMjQ7IC8vIDEwME1CXG4gIFxuICAgICAgaWYgKCFBTExPV0VEX1RZUEVTLmluY2x1ZGVzKGZpbGUudHlwZSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBmaWxlIHR5cGUuIE9ubHkgTVA0LCBBVkksIGFuZCBRdWlja1RpbWUgdmlkZW9zIGFyZSBhbGxvd2VkLlwiKTtcbiAgICAgIH1cbiAgXG4gICAgICBpZiAoZmlsZS5zaXplID4gTUFYX0ZJTEVfU0laRSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJGaWxlIGlzIHRvbyBsYXJnZS4gTWF4aW11bSBzaXplIGlzIDEwME1CLlwiKTtcbiAgICAgIH1cbiAgXG4gICAgICAvLyBHZW5lcmF0ZSB1bmlxdWUgZmlsZW5hbWVcbiAgICAgIGNvbnN0IGZpbGVOYW1lID0gYCR7RGF0ZS5ub3coKX1fJHtmaWxlLm5hbWV9YDtcbiAgICAgIGNvbnN0IHN0b3JhZ2VQYXRoID0gYHZpZGVvcy8ke3VzZXIudWlkfS8ke2ZpbGVOYW1lfWA7XG4gICAgICBcbiAgICAgIC8vIENyZWF0ZSBzdG9yYWdlIHJlZmVyZW5jZVxuICAgICAgY29uc3Qgc3RvcmFnZVJlZiA9IHJlZihnZXRTdG9yYWdlKCksIHN0b3JhZ2VQYXRoKTtcbiAgXG4gICAgICB0cnkge1xuICAgICAgICAvLyBVcGxvYWQgdGhlIGZpbGVcbiAgICAgICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCB1cGxvYWRCeXRlcyhzdG9yYWdlUmVmLCBmaWxlKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEdldCBkb3dubG9hZCBVUkxcbiAgICAgICAgY29uc3QgZG93bmxvYWRVUkwgPSBhd2FpdCBnZXREb3dubG9hZFVSTChzbmFwc2hvdC5yZWYpO1xuICAgICAgICBcbiAgICAgICAgLy8gQ29uc3RydWN0IEdTIFVSTCAoR29vZ2xlIFN0b3JhZ2UgVVJMKVxuICAgICAgICBjb25zdCBnc1VSTCA9IGBnczovLyR7c25hcHNob3QucmVmLmJ1Y2tldH0vJHtzbmFwc2hvdC5yZWYuZnVsbFBhdGh9YDtcbiAgXG4gICAgICAgIHJldHVybiB7IGdzVVJMLCBkb3dubG9hZFVSTCB9O1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlZpZGVvIHVwbG9hZCBmYWlsZWRcIiwgZXJyb3IpO1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICB9XG5cbiAgYXN5bmMgdXBsb2FkSW1hZ2UoXG4gICAgZmlsZTogRmlsZSwgXG4gICAgaW1hZ2VUeXBlOiBVcGxvYWRJbWFnZVR5cGUgPSBVcGxvYWRJbWFnZVR5cGUuUHJvZmlsZVxuICApOiBQcm9taXNlPFVwbG9hZFJlc3VsdD4ge1xuICAgIC8vIEVuc3VyZSB1c2VyIGlzIGF1dGhlbnRpY2F0ZWRcbiAgICBjb25zdCB1c2VyID0gYXV0aC5jdXJyZW50VXNlcjtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlVzZXIgbXVzdCBiZSBhdXRoZW50aWNhdGVkIHRvIHVwbG9hZCBpbWFnZVwiKTtcbiAgICB9XG5cbiAgICAvLyBHZW5lcmF0ZSB1bmlxdWUgZmlsZW5hbWVcbiAgICBjb25zdCBmaWxlTmFtZSA9IGAke0RhdGUubm93KCl9XyR7ZmlsZS5uYW1lfWA7XG4gICAgY29uc3Qgc3RvcmFnZVBhdGggPSBgJHtpbWFnZVR5cGV9LyR7dXNlci51aWR9LyR7ZmlsZU5hbWV9YDtcbiAgICBcbiAgICAvLyBDcmVhdGUgc3RvcmFnZSByZWZlcmVuY2VcbiAgICBjb25zdCBzdG9yYWdlUmVmID0gcmVmKHRoaXMuc3RvcmFnZSwgc3RvcmFnZVBhdGgpO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFVwbG9hZCB0aGUgZmlsZVxuICAgICAgY29uc3Qgc25hcHNob3QgPSBhd2FpdCB1cGxvYWRCeXRlcyhzdG9yYWdlUmVmLCBmaWxlKTtcbiAgICAgIFxuICAgICAgLy8gR2V0IGRvd25sb2FkIFVSTFxuICAgICAgY29uc3QgZG93bmxvYWRVUkwgPSBhd2FpdCBnZXREb3dubG9hZFVSTChzbmFwc2hvdC5yZWYpO1xuICAgICAgXG4gICAgICAvLyBDb25zdHJ1Y3QgR1MgVVJMIChHb29nbGUgU3RvcmFnZSBVUkwpXG4gICAgICBjb25zdCBnc1VSTCA9IGBnczovLyR7c25hcHNob3QucmVmLmJ1Y2tldH0vJHtzbmFwc2hvdC5yZWYuZnVsbFBhdGh9YDtcblxuICAgICAgLy8gSWYgaXQncyBhIHByb2ZpbGUgaW1hZ2UsIHVwZGF0ZSB0aGUgdXNlclxuICAgICAgaWYgKGltYWdlVHlwZSA9PT0gVXBsb2FkSW1hZ2VUeXBlLlByb2ZpbGUpIHtcbiAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVVc2VyUHJvZmlsZUltYWdlKGRvd25sb2FkVVJMKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgZ3NVUkwsIGRvd25sb2FkVVJMIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJJbWFnZSB1cGxvYWQgZmFpbGVkXCIsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgdXBkYXRlVXNlclByb2ZpbGVJbWFnZShpbWFnZVVSTDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gRW5zdXJlIGN1cnJlbnQgdXNlciBleGlzdHNcbiAgICBpZiAoIXVzZXJTZXJ2aWNlLmN1cnJlbnRVc2VyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyBjdXJyZW50IHVzZXIgZm91bmRcIik7XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIGEgbmV3IFVzZXIgb2JqZWN0IHdpdGggdXBkYXRlZCBwcm9maWxlIGltYWdlXG4gICAgY29uc3QgdXBkYXRlZFVzZXIgPSBuZXcgVXNlcih7XG4gICAgICAuLi51c2VyU2VydmljZS5jdXJyZW50VXNlci50b0RpY3Rpb25hcnkoKSxcbiAgICAgIHByb2ZpbGVJbWFnZToge1xuICAgICAgICBwcm9maWxlSW1hZ2VVUkw6IGltYWdlVVJMLFxuICAgICAgICBpbWFnZU9mZnNldFdpZHRoOiAwLCAgLy8gWW91IG1pZ2h0IHdhbnQgdG8gbWFrZSB0aGVzZSBjb25maWd1cmFibGVcbiAgICAgICAgaW1hZ2VPZmZzZXRIZWlnaHQ6IDBcbiAgICAgIH0sXG4gICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKClcbiAgICB9KTtcblxuICAgIC8vIFVwZGF0ZSB1c2VyIGluIEZpcmVzdG9yZVxuICAgIGF3YWl0IHVzZXJTZXJ2aWNlLnVwZGF0ZVVzZXIodXBkYXRlZFVzZXIuaWQsIHVwZGF0ZWRVc2VyKTtcbiAgfVxuXG4gIC8vIE9wdGlvbmFsOiBJbWFnZSBjYWNoaW5nIHNpbWlsYXIgdG8gaU9TIGltcGxlbWVudGF0aW9uXG4gIHByaXZhdGUgaW1hZ2VDYWNoZTogTWFwPHN0cmluZywgc3RyaW5nPiA9IG5ldyBNYXAoKTtcblxuICBhc3luYyBmZXRjaEltYWdlKHVybDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAvLyBDaGVjayBjYWNoZSBmaXJzdFxuICAgIGlmICh0aGlzLmltYWdlQ2FjaGUuaGFzKHVybCkpIHtcbiAgICAgIHJldHVybiB0aGlzLmltYWdlQ2FjaGUuZ2V0KHVybCkhO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCk7XG4gICAgICBjb25zdCBibG9iID0gYXdhaXQgcmVzcG9uc2UuYmxvYigpO1xuICAgICAgY29uc3QgaW1hZ2VVUkwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgXG4gICAgICAvLyBDYWNoZSB0aGUgaW1hZ2UgVVJMXG4gICAgICB0aGlzLmltYWdlQ2FjaGUuc2V0KHVybCwgaW1hZ2VVUkwpO1xuICAgICAgXG4gICAgICByZXR1cm4gaW1hZ2VVUkw7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJJbWFnZSBmZXRjaCBmYWlsZWRcIiwgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG59XG5cblxuLy8gSW4gRmlyZWJhc2VTdG9yYWdlU2VydmljZS50cywgdXBkYXRlIHRoZSBWaWRlb1RyaW1tZXJTZXJ2aWNlIGNsYXNzXG5cbmV4cG9ydCBjbGFzcyBWaWRlb1RyaW1tZXJTZXJ2aWNlIHtcbiAgICB0cmltVmlkZW8oXG4gICAgICBmaWxlOiBGaWxlLFxuICAgICAgc3RhcnRUaW1lOiBudW1iZXIsXG4gICAgICBlbmRUaW1lOiBudW1iZXIsXG4gICAgICBvblByb2dyZXNzPzogKHByb2dyZXNzOiBudW1iZXIpID0+IHZvaWRcbiAgICApOiBQcm9taXNlPEZpbGU+IHtcbiAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGNvbnN0IHZpZGVvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInZpZGVvXCIpO1xuICAgICAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgICBpZiAoIWN0eCkge1xuICAgICAgICAgIHJldHVybiByZWplY3QobmV3IEVycm9yKFwiVW5hYmxlIHRvIGdldCBjYW52YXMgY29udGV4dFwiKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2h1bmtzOiBCbG9iW10gPSBbXTtcbiAgXG4gICAgICAgIHZpZGVvLnNyYyA9IFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZSk7XG4gIFxuICAgICAgICB2aWRlby5vbmxvYWRlZG1ldGFkYXRhID0gKCkgPT4ge1xuICAgICAgICAgIGNhbnZhcy53aWR0aCA9IHZpZGVvLnZpZGVvV2lkdGg7XG4gICAgICAgICAgY2FudmFzLmhlaWdodCA9IHZpZGVvLnZpZGVvSGVpZ2h0O1xuICAgICAgICAgIHZpZGVvLmN1cnJlbnRUaW1lID0gc3RhcnRUaW1lO1xuICAgICAgICB9O1xuICBcbiAgICAgICAgLy8gV2FpdCB1bnRpbCB0aGUgdmlkZW8gaGFzIHNlZWtlZCB0byBzdGFydFRpbWUgYmVmb3JlIHN0YXJ0aW5nIHJlY29yZGluZ1xuICAgICAgICB2aWRlby5vbnNlZWtlZCA9ICgpID0+IHtcbiAgICAgICAgICBjb25zdCBzdHJlYW0gPSBjYW52YXMuY2FwdHVyZVN0cmVhbSgpO1xuICAgICAgICAgIGNvbnN0IG1lZGlhUmVjb3JkZXIgPSBuZXcgTWVkaWFSZWNvcmRlcihzdHJlYW0pO1xuICBcbiAgICAgICAgICBtZWRpYVJlY29yZGVyLm9uZGF0YWF2YWlsYWJsZSA9IChlOiBCbG9iRXZlbnQpID0+IHtcbiAgICAgICAgICAgIGlmIChlLmRhdGEuc2l6ZSA+IDApIHtcbiAgICAgICAgICAgICAgY2h1bmtzLnB1c2goZS5kYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICBcbiAgICAgICAgICBtZWRpYVJlY29yZGVyLm9uc3RvcCA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihjaHVua3MsIHsgdHlwZTogY2h1bmtzWzBdPy50eXBlIHx8IFwidmlkZW8vd2VibVwiIH0pO1xuICAgICAgICAgICAgLy8gRm9yY2UgdGhlIGZpbGUgdHlwZSB0byBcInZpZGVvL3dlYm1cIiBzbyBpdCBwYXNzZXMgdGhlIGFsbG93ZWQgZm9ybWF0cyBjaGVja1xuICAgICAgICAgICAgY29uc3QgdHJpbW1lZEZpbGUgPSBuZXcgRmlsZShbYmxvYl0sIGZpbGUubmFtZSwgeyB0eXBlOiBcInZpZGVvL3dlYm1cIiB9KTtcbiAgICAgICAgICAgIFVSTC5yZXZva2VPYmplY3RVUkwodmlkZW8uc3JjKTtcbiAgICAgICAgICAgIHJlc29sdmUodHJpbW1lZEZpbGUpO1xuICAgICAgICAgIH07XG4gIFxuICAgICAgICAgIG1lZGlhUmVjb3JkZXIuc3RhcnQoKTtcbiAgICAgICAgICB2aWRlby5wbGF5KCk7XG4gIFxuICAgICAgICAgIHZpZGVvLm9udGltZXVwZGF0ZSA9ICgpID0+IHtcbiAgICAgICAgICAgIGlmICh2aWRlby5jdXJyZW50VGltZSA+PSBlbmRUaW1lKSB7XG4gICAgICAgICAgICAgIG1lZGlhUmVjb3JkZXIuc3RvcCgpO1xuICAgICAgICAgICAgICB2aWRlby5wYXVzZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY3R4LmRyYXdJbWFnZSh2aWRlbywgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbiAgICAgICAgICAgICAgaWYgKG9uUHJvZ3Jlc3MpIHtcbiAgICAgICAgICAgICAgICBvblByb2dyZXNzKCh2aWRlby5jdXJyZW50VGltZSAtIHN0YXJ0VGltZSkgLyAoZW5kVGltZSAtIHN0YXJ0VGltZSkpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgfTtcbiAgXG4gICAgICAgIHZpZGVvLm9uZXJyb3IgPSAoKSA9PiB7XG4gICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcihcIkVycm9yIGxvYWRpbmcgdmlkZW9cIikpO1xuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgfVxuICB9XG4gIFxuICBcblxuZXhwb3J0IGNvbnN0IHZpZGVvVHJpbW1lclNlcnZpY2UgPSBuZXcgVmlkZW9UcmltbWVyU2VydmljZSgpO1xuXG4vLyBDcmVhdGUgYSBzaW5nbGV0b24gaW5zdGFuY2VcbmV4cG9ydCBjb25zdCBmaXJlYmFzZVN0b3JhZ2VTZXJ2aWNlID0gbmV3IEZpcmViYXNlU3RvcmFnZVNlcnZpY2UoKTsiXSwibmFtZXMiOlsiZ2V0U3RvcmFnZSIsInJlZiIsInVwbG9hZEJ5dGVzIiwiZ2V0RG93bmxvYWRVUkwiLCJVc2VyIiwidXNlclNlcnZpY2UiLCJhdXRoIiwiVXBsb2FkSW1hZ2VUeXBlIiwiVmlkZW9UeXBlIiwiRmlyZWJhc2VTdG9yYWdlU2VydmljZSIsInN0b3JhZ2UiLCJpbWFnZUNhY2hlIiwiTWFwIiwidXBsb2FkVmlkZW8iLCJmaWxlIiwidmlkZW9UeXBlIiwidXNlciIsIkFMTE9XRURfVFlQRVMiLCJNQVhfRklMRV9TSVpFIiwiZmlsZU5hbWUiLCJzdG9yYWdlUGF0aCIsInN0b3JhZ2VSZWYiLCJzbmFwc2hvdCIsImRvd25sb2FkVVJMIiwiZ3NVUkwiLCJlcnJvciIsImN1cnJlbnRVc2VyIiwiRXJyb3IiLCJpbmNsdWRlcyIsInR5cGUiLCJzaXplIiwiRGF0ZSIsIm5vdyIsIm5hbWUiLCJ1aWQiLCJidWNrZXQiLCJmdWxsUGF0aCIsImNvbnNvbGUiLCJ1cGxvYWRJbWFnZSIsImltYWdlVHlwZSIsInVwZGF0ZVVzZXJQcm9maWxlSW1hZ2UiLCJpbWFnZVVSTCIsInVwZGF0ZWRVc2VyIiwidG9EaWN0aW9uYXJ5IiwicHJvZmlsZUltYWdlIiwicHJvZmlsZUltYWdlVVJMIiwiaW1hZ2VPZmZzZXRXaWR0aCIsImltYWdlT2Zmc2V0SGVpZ2h0IiwidXBkYXRlZEF0IiwidXBkYXRlVXNlciIsImlkIiwiZmV0Y2hJbWFnZSIsInVybCIsInJlc3BvbnNlIiwiYmxvYiIsImhhcyIsImdldCIsImZldGNoIiwiVVJMIiwiY3JlYXRlT2JqZWN0VVJMIiwic2V0IiwiVmlkZW9UcmltbWVyU2VydmljZSIsInRyaW1WaWRlbyIsInN0YXJ0VGltZSIsImVuZFRpbWUiLCJvblByb2dyZXNzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJ2aWRlbyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImNhbnZhcyIsImN0eCIsImdldENvbnRleHQiLCJjaHVua3MiLCJzcmMiLCJvbmxvYWRlZG1ldGFkYXRhIiwid2lkdGgiLCJ2aWRlb1dpZHRoIiwiaGVpZ2h0IiwidmlkZW9IZWlnaHQiLCJjdXJyZW50VGltZSIsIm9uc2Vla2VkIiwic3RyZWFtIiwiY2FwdHVyZVN0cmVhbSIsIm1lZGlhUmVjb3JkZXIiLCJNZWRpYVJlY29yZGVyIiwib25kYXRhYXZhaWxhYmxlIiwiZSIsImRhdGEiLCJwdXNoIiwib25zdG9wIiwiQmxvYiIsInRyaW1tZWRGaWxlIiwiRmlsZSIsInJldm9rZU9iamVjdFVSTCIsInN0YXJ0IiwicGxheSIsIm9udGltZXVwZGF0ZSIsInN0b3AiLCJwYXVzZSIsImRyYXdJbWFnZSIsIm9uZXJyb3IiLCJ2aWRlb1RyaW1tZXJTZXJ2aWNlIiwiZmlyZWJhc2VTdG9yYWdlU2VydmljZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./src/api/firebase/storage/service.ts\n"));

/***/ })

});